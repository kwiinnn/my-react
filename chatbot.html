<!DOCTYPE html>
<html>
	<head>
	<title>Chatbot</title>
  <link rel="stylesheet" href="styles/chatbot.css">
	</head>
	<body>
	<div class="js-container"></div>

	<script src="react-basics.js"></script>

	<script src="https://unpkg.com/supersimpledev/react.js"></script>
	<script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
	<script src="https://unpkg.com/supersimpledev/babel.js"></script>
	<script type="text/babel">

		function ChatInput( {chatMessages, setChatMessages} ) {
      const [inputText, setInputText ] = React.useState('');

      function saveInputText (event) {
        setInputText(event.target.value);
      }

      function sendMessage() {
        const newChatMessages = [...chatMessages, 
        {
          message: inputText,
          sender: 'user',
          id: crypto.randomUUID()
        }];
        
        setChatMessages(newChatMessages);

        const response = Chatbot.getResponse(inputText);

        setChatMessages([
          ...newChatMessages, 
          {
            message: response,
            sender: 'robot',
            id: crypto.randomUUID()
          }
        ]);

        setInputText('');
      }


			return (
			<div className="chat-input-container">
				<input 
					placeholder="Send a message to Cha" 
					size="40"
          onChange={saveInputText}
          value={inputText}
          className="input-text"
				/>
				<button
          onClick={sendMessage}
          className="send-button"
        >Send</button>
			</div>
			);
		}

		function ChatMessage( { message, sender } ) {
			return (
				<div className={
          sender==='user' ? 'message-user': 'message-robot'
        }>
					{sender === 'robot' && (
						<img src="assets/cha.png" width="50px"/>
					)}
					{message}
					{sender === 'user' && (
						<img src="assets/user.png" width="50px"/>
					)}
				</div>
			);
		}

    function ChatMessages ( {chatMessages} ) {
      
      return (
      <div>
        {chatMessages.map((chatMessage) => {
          return (
            <ChatMessage 
              message = {chatMessage.message}
              sender = {chatMessage.sender}
              key = {chatMessage.id}
            />
          );
        })}
      </div>
      );

    }

		function App () {
      const [chatMessages, setChatMessages] = React.useState([{
				message: 'hello, cha',
				sender: 'user',
        id: 'id1'
			}, {
				message: 'hi',
				sender: 'robot',
        id: 'id2'
			}, {
        message: "i'm sorry, i messed up",
        sender: 'user',
        id: 'id3'
      }, {
        message: "it's fine",
        sender: 'robot',
        id: 'id4'
      }]);
			return (
				<div className="app-container">
          <ChatInput 
            chatMessages={chatMessages}
            setChatMessages={setChatMessages}
          />
          <ChatMessages 
            chatMessages={chatMessages}
          />
					
				</div>
			);
		}
		
		const container = document.querySelector('.js-container');
		ReactDOM.createRoot(container).render(<App/>);
	</script>
	</body>
</html>